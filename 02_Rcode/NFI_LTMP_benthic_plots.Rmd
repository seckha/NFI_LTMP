---
title: "NFI LTMP Benthic Plots"
author: "Shannon Eckhardt"
date: "2023-10-12"
output: html_document
---

# LOAD LIBRARIES & DATA
```{r}
library(tidyverse)
library(readxl)


master_data <- read_excel("/Users/Shannon/GitHub/NFI_LTMP/01_Data/Benthic_cover_March20-March23.xlsx")
```

# DATA CLEANING

```{r}
# Pick out site, transect_ID and PQ
master_data <- master_data %>%
  mutate(Site = str_extract(Image_ID, "[A-Z]{2}"),
         Transect_ID = str_extract(Image_ID, "[A-Z]{2}\\d+(?=_)"),
  # extract the number before the end of string
         PQ = str_extract(Image_ID, "\\d+$")) %>% 
  dplyr::select(Image_ID, TP, Site, Transect_ID, PQ, everything()) # reorder columns
```

# CATEGORIES

Transpose data
```{r}
t.cover <- master_data %>% pivot_longer(c(ABH:`T`), names_to = "Genera", values_to = "Cover")
```
Grouping into broader categories
```{r}
benthic.cats <- t.cover %>%
  mutate(Category = 
      ifelse(Genera %in% c("ACH"),
             "Acanthastrea",
      ifelse(Genera %in% c("ABH"), 
             "Acropora_branch",
      ifelse(Genera %in% c("ANH"), 
             "Acropora_non_branch",
      ifelse(Genera %in% c("GOH"), 
             "Goniopora",
      ifelse(Genera %in% c("MEH"),
               "Montipora_encrusting",
      ifelse(Genera %in% c("MPH"),
             "Montipora_plating", 
      ifelse(Genera %in% c("OBH"),
             "Pocilloporidae", 
      ifelse(Genera %in% c("PLH"),
             "Platygyra",   
      ifelse(Genera %in% c("POH"),
             "Porites", 
      ifelse(Genera %in% c("OG"),
             "Other hard coral", 
      ifelse(Genera %in% c("S"),
             "Sand",
      ifelse(Genera %in% c("R","BARK"),
             "Rubble and Rock", 
      ifelse(Genera %in% c("Flesh", "Fol", "Dictyota", "Caulerpa", "Leath", "ACA", "CCA"),
             "Macroalgae", 
      ifelse(Genera %in% c("RT"),
             "Red Turf", 
      ifelse(Genera %in% c("T"),
             "Green Turf",
      ifelse(Genera %in% c("OtT"),
             "Other Turf",
      ifelse(Genera %in% c("BT"),
             "Black Turf",
      ifelse(Genera %in% c("ASCD", "anemo", "ESCB", "soft", "Urchin"),
             "Other benthic invertebrates",
      ifelse(Genera %in% c("NA"),
               "Other","NA"
             ))))))))))))))))))))
```
Sum counts/cover per quadrat
```{r}
groups_sum <- benthic.cats %>% 
  group_by(TP,Transect_ID,PQ,Category) %>%
  summarise(Total_cover = sum(Cover))

write.csv(groups_sum, file = "/Users/Shannon/GitHub/NFI_LTMP/01_Data/Cover_per_category_per_quadrat.csv")

# search for NAs
filter(groups_sum, Category == "NA")

# no NAs because dead coral is now in the category R = Rubble
```

